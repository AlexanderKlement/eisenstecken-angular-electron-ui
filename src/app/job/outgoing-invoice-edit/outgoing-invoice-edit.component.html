<app-toolbar [beforeBackFunction]="unlockFunction"></app-toolbar>
<h1 *ngIf="createMode">Rechnung erstellen</h1>
<h1 *ngIf="!createMode">Rechnung bearbeiten</h1>
<form (ngSubmit)="onSubmit()" [formGroup]="invoiceGroup">
  <div fxLayout="row" fxLayoutAlign=" start">
    <div formArrayName="descriptive_articles" fxLayout="column" fxLayoutAlign="space-around center">
      <div *ngFor="let descriptiveArticle of getDescriptiveArticles().controls; let i = index">
        <div fxLayout="column" fxLayoutAlign="space-around center" [formGroupName]="i">
          <div fxLayout="row" fxLayoutAlign="start center">
            <mat-form-field appearance="fill">
              <mat-label>Name</mat-label>
              <input class="form-control" formControlName="description"  matInput>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Amount</mat-label>
              <input class="form-control" formControlName="amount" matInput>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Einzelpreis</mat-label>
              <input class="form-control" formControlName="single_price" matInput>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Gesamtpreis</mat-label>
              <input readonly class="form-control" formControlName="total_price" matInput>
            </mat-form-field>
            <button type="button" mat-icon-button (click)="addDescriptiveArticleAt(i)">
              <mat-icon>add</mat-icon>
            </button>
            <button type="button" mat-button (click)="removeDescriptiveArticle(i)" [disabled]="i == 0">
              <mat-icon>remove</mat-icon>
            </button>
            <button type="button" mat-icon-button (click)="moveDescriptiveArticleUp(i)" [disabled]="i == 0">
              <mat-icon>arrow_upward</mat-icon>
            </button>
            <button type="button" mat-icon-button (click)="moveDescriptiveArticleDown(i)" [disabled]="i == getDescriptiveArticles().controls.length - 1">
              <mat-icon>arrow_downward</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div fxLayout="column" fxLayoutAlign="space-around center">
      <mat-form-field appearance="fill">
        <mat-label>Nummer</mat-label>
        <input class="form-control" formControlName="number" matInput>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Datum</mat-label>
        <input formControlName="date" matInput [matDatepicker]="date_picker">
        <mat-datepicker-toggle matSuffix [for]="date_picker"></mat-datepicker-toggle>
        <mat-datepicker #date_picker></mat-datepicker>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Mehrwertsteuer: </mat-label>
        <mat-select formControlName="vat_id">
          <mat-option *ngFor="let vat of vatOptions$ | async" [value]="vat.id">
            {{vat.name}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Zahlungsbedingung: </mat-label>
        <textarea class="form-control" formControlName="payment_condition" matInput></textarea>
      </mat-form-field>
      <mat-form-field appearance="fill">
        <mat-label>Zahlungsdatum</mat-label>
        <input formControlName="payment_date" matInput [matDatepicker]="payment_date_picker">
        <mat-datepicker-toggle matSuffix [for]="payment_date_picker"></mat-datepicker-toggle>
        <mat-datepicker #payment_date_picker></mat-datepicker>
      </mat-form-field>
      <button [disabled]="submitted" mat-raised-button type="submit">Speichern</button>
    </div>
  </div>
</form>

<pre> {{invoiceGroup.value | json}} </pre>

